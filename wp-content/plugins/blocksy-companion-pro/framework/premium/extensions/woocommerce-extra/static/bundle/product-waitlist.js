!function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e){var i=function(e,i){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,i||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==t(i)?i:i+""}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function r(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=window.ctFrontend;function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function n(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?a(Object(r),!0).forEach((function(i){var o,a,n;o=t,a=i,n=r[i],(a=e(a))in o?Object.defineProperty(o,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[a]=n})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var s=function(t,e,i){var r=t.querySelectorAll(".ct-waitlist-users");r.length&&r.forEach((function(t){t.dataset.count=e,t.innerHTML=i}))},c=function(t,e){if(!e||e.blocksy_stock_quantity>0||e.is_in_stock&&!e.backorders_allowed||e.backorders_allowed&&"no"===ct_localizations.blc_ext_waitlist.waitlist_allow_backorders)t.dataset.state="hidden";else{if(e.blocksy_waitlist.subscription_id||ct_localizations.blc_ext_waitlist.list.includes(e.variation_id)){t.dataset.state="subscribed";var i=t.querySelector(".unsubscribe");return i&&(i.dataset.token=e.blocksy_waitlist.unsubscribe_token,i.dataset.id=e.variation_id),void s(t,e.blocksy_waitlist.waitlist_users,e.blocksy_waitlist.waitlist_users_message)}s(t,e.blocksy_waitlist.waitlist_users,e.blocksy_waitlist.waitlist_users_message),t.dataset.state="visible"}},l=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=ct_localizations.blc_ext_waitlist,o=i.user_logged_in,a=i.list;if("no"===o){var n=e?a.filter((function(e){return e!==t})):[].concat(r(a),[t]);ct_localizations.blc_ext_waitlist.list=n;var s=new Date(Date.now()+31536e6).toGMTString();document.cookie="".concat("blc_products_waitlist","=").concat(JSON.stringify(n),"; expires=").concat(s,"; path=/")}},u=function(t){var e=new FormData;e.append("action","blc_waitlist_unsubscribe"),e.append("token",t.dataset.token);var i=t.closest(".waitlist-product-actions")||t.closest(".ct-product-waitlist");i.dataset.loading="";var r=t.closest(".product"),o="";if(r){var a;o=null===(a=r.className.match(/post-(\d+)/))||void 0===a?void 0:a[1];var n=r.querySelector('[name="variation_id"]');n&&n.value&&(o=n.value)}e.append("product_id",o),fetch(ct_localizations.ajax_url,{method:"POST",body:e}).then((function(t){return t.json()})).then((function(e){var r=e.success,o=e.data;r?(i.dataset.state="",s(i,o.waitlist_users,o.waitlist_users_message),l(t.dataset.id,!0),function(t){var e=t.closest(".ct-woocommerce-waitlist-table-row");e&&(1===document.querySelectorAll(".ct-woocommerce-waitlist-table-row").length?window.location.reload():e.remove())}(t)):alert(o.message)})).finally((function(){i.removeAttribute("data-loading")}))};(0,o.registerDynamicChunk)("blocksy_ext_woo_extra_waitlist",{mount:function(t,e){if(e){var i=e.event,r=e.eventData;"submit"!==i.type?"click"===i.type&&t.classList.contains("unsubscribe")?u(t):"reset_data"!==i.type&&"found_variation"!==i.type||c(t,r):function(t){var e,i=new FormData(t);i.append("action","blc_subcribe_to_waitlist");var r=t.closest(".ct-product-waitlist");r.dataset.loading="";var o=t.closest(".product"),a=null===(e=o.className.match(/post-(\d+)/))||void 0===e?void 0:e[1],n=o.querySelector('[name="variation_id"]');n&&n.value&&(a=n.value),i.append("product_id",a),fetch(ct_localizations.ajax_url,{method:"POST",body:i}).then((function(t){return t.json()})).then((function(e){var i=e.success,o=e.data;i?(r.dataset.state="subscribed",s(r,o.waitlist_users,o.waitlist_users_message),l(o.subscription_id),function(t,e){var i=t.closest(".ct-product-waitlist").querySelector(".unsubscribe");i&&(i.dataset.token=e.token,i.dataset.id=e.productId)}(t,{token:o.unsubscribe_token,productId:a})):alert(o.message)})).finally((function(){r.removeAttribute("data-loading")}))}(t)}else!function(t){var e,i=t.closest(".product"),r=null===(e=i.className.match(/post-(\d+)/))||void 0===e?void 0:e[1],o=i.querySelector('[name="variation_id"]');o&&o.value&&(r=o.value);var a=new FormData;a.append("action","blc_waitlist_sync"),a.append("product_id",r),fetch(ct_localizations.ajax_url,{method:"POST",body:a}).then((function(t){return t.json()})).then((function(e){var i=e.success,r=e.data;r.subscription_id&&i&&c(t.closest(".ct-product-waitlist"),{blocksy_waitlist:n({},r)})}))}(t)}})}();